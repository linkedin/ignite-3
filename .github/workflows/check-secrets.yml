name: Check Release Secrets (manual)

on:
  workflow_dispatch:

jobs:
  check-secrets:
    name: Check secrets are set (safe)
    runs-on: ubuntu-22.04

    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      ARTIFACTORY_USER: ${{ secrets.ARTIFACTORY_USER }}
      ARTIFACTORY_KEY: ${{ secrets.ARTIFACTORY_KEY }}

    steps:
      - name: Check secrets are set (safe)
        run: |
          # Do NOT print secret values. Only report presence/absence.
          check_var() {
            if [ -z "$1" ]; then
              echo "$2: EMPTY"
            else             
              echo -n "$1" | sha256sum | awk '{print "$2 (SHA): " $1}'
              echo -n "$1" | wc -c | awk '{print "$1 (Len): " $1}'
            fi
          }

          check_var "${GITHUB_TOKEN}" "GITHUB_TOKEN"
          check_var "${ARTIFACTORY_USER}" "ARTIFACTORY_USER"
          check_var "${ARTIFACTORY_KEY}" "ARTIFACTORY_KEY"
          curl -u "${{ secrets.ARTIFACTORY_USER }}:${{ secrets.ARTIFACTORY_KEY }}" \ -X GET "https://linkedin.jfrog.io/artifactory/api/system/ping"
